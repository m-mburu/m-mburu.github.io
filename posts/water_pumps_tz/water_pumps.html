<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Mburu">
<meta name="dcterms.date" content="2020-04-21">

<title>Mburu Blog - Tanzanian Water Pumps</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script src="../../site_libs/htmlwidgets-1.6.1/htmlwidgets.js"></script>
<link href="../../site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="../../site_libs/datatables-binding-0.27/datatables.js"></script>
<script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../site_libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="../../site_libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="../../site_libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
<link href="../../site_libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="../../site_libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>


<link rel="stylesheet" href="../../style.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Mburu Blog</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/m-mburu"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/mmburu_w"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Tanzanian Water Pumps</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Mburu </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 21, 2020</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>train_y <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">"0bf8bc6e-30d0-4c50-956a-603fc693d966.csv"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>train_x <span class="ot">&lt;-</span>  <span class="fu">fread</span>(<span class="st">"4910797b-ee55-40a7-8668-10efd5c1b960.csv"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">"702ddfc5-68cd-4d1d-a0de-f5f566f76d91.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-1" class="level2">
<h2 class="anchored" data-anchor-id="section-1"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> <span class="fu">merge</span>(train_y, train_x, <span class="at">by =</span> <span class="st">"id"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>train_data[, set <span class="sc">:</span><span class="er">=</span> <span class="st">"train"</span>]</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>test[, set <span class="sc">:</span><span class="er">=</span> <span class="st">"test"</span>]</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>pump_data <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(<span class="fu">list</span>(train_data, test), <span class="at">fill =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>train_data[, .N, by <span class="ot">=</span> status_group] <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    .[, Perc <span class="sc">:</span><span class="er">=</span>  <span class="fu">round</span>(N<span class="sc">/</span><span class="fu">sum</span>(N) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)] <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">datatable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-b6d49197258b4dc70e8d" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-b6d49197258b4dc70e8d">{"x":{"filter":"none","vertical":false,"data":[["1","2","3"],["non functional","functional","functional needs repair"],[22824,32259,4317],[38.42,54.31,7.27]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>status_group<\/th>\n      <th>N<\/th>\n      <th>Perc<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>pump_data[amount_tsh <span class="sc">!=</span> <span class="dv">0</span>, .(<span class="at">Mean =</span> <span class="fu">mean</span>(amount_tsh),</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">Median =</span> <span class="fu">median</span>(amount_tsh),</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">Min =</span> <span class="fu">min</span>(amount_tsh),</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">Max =</span> <span class="fu">max</span>(amount_tsh),</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">First_qurtile =</span> <span class="fu">quantile</span>(amount_tsh, .<span class="dv">25</span>),</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">Third_qurtile =</span> <span class="fu">quantile</span>(amount_tsh, .<span class="dv">75</span>)),</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>           by <span class="ot">=</span> status_group] <span class="sc">%&gt;%</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-0178df29e9f06ecc2403" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-0178df29e9f06ecc2403">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4"],["functional","non functional","functional needs repair",null],[1186.74016171433,715.495201827875,908.548463356974,1079.72538288288],[250,200,300,250],[0.25,0.2,6,0.2],[350000,117000,100000,200000],[50,50,100,50],[1000,500,600,1000]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>status_group<\/th>\n      <th>Mean<\/th>\n      <th>Median<\/th>\n      <th>Min<\/th>\n      <th>Max<\/th>\n      <th>First_qurtile<\/th>\n      <th>Third_qurtile<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4,5,6,7]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>col_class <span class="ot">&lt;-</span> <span class="fu">sapply</span>(train_data, class)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>char_cols <span class="ot">&lt;-</span> <span class="fu">names</span>(col_class[col_class <span class="sc">==</span> <span class="st">"character"</span>])</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>char_cols <span class="ot">&lt;-</span> char_cols[char_cols <span class="sc">!=</span> <span class="st">"date_recorded"</span>]</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>char_cols</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "status_group"          "funder"                "installer"            
 [4] "wpt_name"              "basin"                 "subvillage"           
 [7] "region"                "lga"                   "ward"                 
[10] "recorded_by"           "scheme_management"     "scheme_name"          
[13] "extraction_type"       "extraction_type_group" "extraction_type_class"
[16] "management"            "management_group"      "payment"              
[19] "payment_type"          "water_quality"         "quality_group"        
[22] "quantity"              "quantity_group"        "source"               
[25] "source_type"           "source_class"          "waterpoint_type"      
[28] "waterpoint_type_group" "set"                  </code></pre>
</div>
</div>
</section>
<section id="a-lazy-way-of-collapsing-columns-please-do-not-do-it" class="level2">
<h2 class="anchored" data-anchor-id="a-lazy-way-of-collapsing-columns-please-do-not-do-it">A lazy way of collapsing columns, Please DO NOT do it,</h2>
<ul>
<li>It’s best to go through all columns one by one to see how well lumping together will be beneficial</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>factor_cols <span class="ot">&lt;-</span> pump_data[, ..char_cols]</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>factor_cols[, (char_cols) <span class="sc">:</span><span class="er">=</span> <span class="fu">lapply</span>(.SD, str_to_lower), .SDcols <span class="ot">=</span> char_cols]</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>factor_cols[, (char_cols) <span class="sc">:</span><span class="er">=</span> <span class="fu">lapply</span>(.SD,  fct_lump_n, <span class="at">n =</span> <span class="dv">20</span>), .SDcols <span class="ot">=</span> char_cols]</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">#factor_cols[, (char_cols) := lapply(.SD,  fct_lump_n, n = 5), .SDcols = char_cols]</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>factor_cols[factor_cols <span class="sc">==</span> <span class="st">""</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>factor_cols[factor_cols <span class="sc">==</span> <span class="st">"0"</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>factor_cols[, (char_cols) <span class="sc">:</span><span class="er">=</span><span class="fu">lapply</span>(.SD, fct_explicit_na, <span class="at">na_level =</span> <span class="st">"missing"</span>), .SDcols <span class="ot">=</span> char_cols]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>chars_dat <span class="ot">&lt;-</span> <span class="fu">melt</span>(factor_cols, <span class="at">id.vars =</span> <span class="st">"status_group"</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>chars_dat[, .(<span class="at">freq =</span> .N), by <span class="ot">=</span> .(variable, value)] <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  .[, perc <span class="sc">:</span><span class="er">=</span> <span class="fu">round</span>(freq<span class="sc">/</span><span class="fu">sum</span>(freq) <span class="sc">*</span> <span class="dv">100</span>), by <span class="ot">=</span> .(variable)] <span class="sc">%&gt;%</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">datatable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-0bec8f85e74fe1e08b9d" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-0bec8f85e74fe1e08b9d">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317"],["funder","funder","funder","funder","funder","funder","funder","funder","funder","funder","funder","funder","funder","funder","funder","funder","funder","funder","funder","funder","installer","installer","installer","installer","installer","installer","installer","installer","installer","installer","installer","installer","installer","installer","installer","installer","installer","installer","installer","installer","wpt_name","wpt_name","wpt_name","wpt_name","wpt_name","wpt_name","wpt_name","wpt_name","wpt_name","wpt_name","wpt_name","wpt_name","wpt_name","wpt_name","wpt_name","wpt_name","wpt_name","wpt_name","wpt_name","wpt_name","wpt_name","basin","basin","basin","basin","basin","basin","basin","basin","basin","subvillage","subvillage","subvillage","subvillage","subvillage","subvillage","subvillage","subvillage","subvillage","subvillage","subvillage","subvillage","subvillage","subvillage","subvillage","subvillage","subvillage","subvillage","subvillage","subvillage","subvillage","region","region","region","region","region","region","region","region","region","region","region","region","region","region","region","region","region","region","region","region","region","lga","lga","lga","lga","lga","lga","lga","lga","lga","lga","lga","lga","lga","lga","lga","lga","lga","lga","lga","lga","lga","ward","ward","ward","ward","ward","ward","ward","ward","ward","ward","ward","ward","ward","ward","ward","ward","ward","ward","ward","ward","ward","recorded_by","scheme_management","scheme_management","scheme_management","scheme_management","scheme_management","scheme_management","scheme_management","scheme_management","scheme_management","scheme_management","scheme_management","scheme_management","scheme_management","scheme_name","scheme_name","scheme_name","scheme_name","scheme_name","scheme_name","scheme_name","scheme_name","scheme_name","scheme_name","scheme_name","scheme_name","scheme_name","scheme_name","scheme_name","scheme_name","scheme_name","scheme_name","scheme_name","scheme_name","scheme_name","extraction_type","extraction_type","extraction_type","extraction_type","extraction_type","extraction_type","extraction_type","extraction_type","extraction_type","extraction_type","extraction_type","extraction_type","extraction_type","extraction_type","extraction_type","extraction_type","extraction_type","extraction_type","extraction_type_group","extraction_type_group","extraction_type_group","extraction_type_group","extraction_type_group","extraction_type_group","extraction_type_group","extraction_type_group","extraction_type_group","extraction_type_group","extraction_type_group","extraction_type_group","extraction_type_group","extraction_type_class","extraction_type_class","extraction_type_class","extraction_type_class","extraction_type_class","extraction_type_class","extraction_type_class","management","management","management","management","management","management","management","management","management","management","management","management","management_group","management_group","management_group","management_group","management_group","payment","payment","payment","payment","payment","payment","payment","payment_type","payment_type","payment_type","payment_type","payment_type","payment_type","payment_type","water_quality","water_quality","water_quality","water_quality","water_quality","water_quality","water_quality","water_quality","quality_group","quality_group","quality_group","quality_group","quality_group","quality_group","quantity","quantity","quantity","quantity","quantity","quantity_group","quantity_group","quantity_group","quantity_group","quantity_group","source","source","source","source","source","source","source","source","source","source","source_type","source_type","source_type","source_type","source_type","source_type","source_type","source_class","source_class","source_class","waterpoint_type","waterpoint_type","waterpoint_type","waterpoint_type","waterpoint_type","waterpoint_type","waterpoint_type","waterpoint_type_group","waterpoint_type_group","waterpoint_type_group","waterpoint_type_group","waterpoint_type_group","waterpoint_type_group","set","set"],["tasaf","Other","germany republi","government of tanzania","water","world bank","hesawa","missing","kkkt","danida","world vision","district council","unicef","rwssp","dwsp","norad","ministry of water","tcrs","private individual","dhv","tasaf","Other","ces","government","gover","commu","dwe","amref","missing","kkkt","danida","world vision","rwe","hesawa","community","tcrs","danid","district council","central government","lga","Other","none","bombani","mkuyuni","shuleni","mbugani","sokoni","sekondari","zahanati","school","msikitini","kanisani","kituo cha afya","shule ya msingi","mkombozi","ofisini","umoja","madukani","upendo","muungano","shule","lake tanganyika","rufiji","wami / ruvu","pangani","internal","lake victoria","lake nyasa","ruvuma / southern coast","lake rukwa","majengo","Other","songambele","miembeni","sokoni","madukani","missing","shuleni","kibaoni","m","mbuyuni","msikitini","kati","mapinduzi","mjimwema","mtakuja","kanisani","mlimani","muungano","mjini","1","tabora","iringa","dodoma","kilimanjaro","pwani","shinyanga","kagera","tanga","arusha","mwanza","ruvuma","mtwara","kigoma","Other","morogoro","mbeya","mara","lindi","singida","rukwa","manyara","Other","njombe","meru","magu","arusha rural","kasulu","kilosa","kibondo","rungwe","kahama","same","kigoma rural","moshi rural","maswa","mbozi","singida rural","bariadi","kilombero","bagamoyo","kyela","karagwe","Other","vikindu","chanika","kitunda","maji ya chai","mishamo","chalinze","igosi","usuka","imalinyi","nduruma","siha kati","zinga/ikerege","ngarenanyuki","mdandu","mtwango","itete","msindo","maramba","magomeni","matola","geodata consultants ltd","vwc","missing","water board","private operator","wua","water authority","wug","other","company","parastatal","swc","trust","none","missing","Other","government","m","handeni trunk main(h","uroki-bomang'ombe water sup","none","borehole","wanging'ombe supply scheme","danida","chalinze wate","wanging'ombe water supply s","k","ngana water supplied scheme","kijiji","machumba estate pipe line","i","bagamoyo wate","kirua kahe gravity water supply trust","n","makwale water supplied sche","afridev","other - rope pump","mono","gravity","nira/tanira","submersible","other","swn 80","windmill","india mark ii","ksb","cemo","india mark iii","other - swn 81","climax","other - play pump","walimi","other - mkulima/shinyanga","afridev","rope pump","mono","gravity","nira/tanira","submersible","other","swn 80","wind-powered","india mark ii","other motorpump","india mark iii","other handpump","handpump","rope pump","motorpump","gravity","submersible","other","wind-powered","vwc","water board","private operator","wua","wug","company","water authority","other","unknown","parastatal","trust","other - school","user-group","commercial","other","unknown","parastatal","unknown","never pay","pay per bucket","pay when scheme fails","pay monthly","pay annually","other","unknown","never pay","per bucket","on failure","monthly","annually","other","milky","soft","salty","salty abandoned","coloured","unknown","fluoride","fluoride abandoned","milky","good","salty","colored","unknown","fluoride","enough","insufficient","dry","seasonal","unknown","enough","insufficient","dry","seasonal","unknown","shallow well","machine dbh","spring","rainwater harvesting","river","lake","other","dam","hand dtw","unknown","shallow well","borehole","spring","rainwater harvesting","river/lake","other","dam","groundwater","surface","unknown","hand pump","communal standpipe multiple","communal standpipe","other","improved spring","cattle trough","dam","hand pump","communal standpipe","other","improved spring","cattle trough","dam","train","test"],[1136,33665,765,11299,739,1701,2782,5484,1623,3907,1562,1037,1324,1703,1012,949,728,735,1034,1065,523,29225,765,2367,653,1354,21756,538,5512,1135,1306,867,1498,1768,690,887,786,1181,933,506,62710,4442,323,103,2183,113,328,178,1034,260,647,390,113,247,145,321,105,128,130,159,191,8052,9987,7577,11143,9642,12871,6332,5587,3059,631,68575,194,168,294,629,470,646,143,243,210,164,467,126,129,322,146,190,215,131,157,2466,6599,2779,5494,3331,6293,4174,3186,4111,3897,3306,2144,3533,1020,5038,5758,2451,1920,2536,2242,1972,47887,3128,1244,1049,1521,1322,1368,1101,1381,1058,1106,1015,1566,1024,1286,1202,1485,1207,1263,1070,967,69556,199,221,260,227,251,238,386,222,318,261,297,185,212,292,189,179,243,167,170,177,74250,45917,4846,3462,1326,3551,3975,6496,996,1341,2124,123,92,1,35258,31515,395,490,204,266,828,704,287,483,502,323,861,335,205,225,281,384,237,258,209,2208,572,3628,33263,10205,5982,8102,4588,152,3029,1790,108,135,284,41,101,60,2,2208,572,3628,33263,10205,7772,8102,4588,152,3029,149,135,447,20612,572,3777,33263,7772,8102,152,50624,3688,2504,3118,8108,859,1123,1083,683,2229,105,126,65538,4591,1209,683,2229,10149,31712,11266,4842,10397,4570,1314,10149,31712,11266,4842,10397,4570,1314,1005,63505,6082,423,623,2345,244,23,1005,63505,6505,623,2345,267,41522,18896,7782,5075,975,41522,18896,7782,5075,975,21140,13822,21216,2863,11964,950,261,840,1108,86,21140,14930,21216,2863,12914,347,840,57286,16617,347,21884,7611,35628,8010,959,150,8,21884,43239,8010,959,150,8,59400,14850],[2,45,1,15,1,2,4,7,2,5,2,1,2,2,1,1,1,1,1,1,1,39,1,3,1,2,29,1,7,2,2,1,2,2,1,1,1,2,1,1,84,6,0,0,3,0,0,0,1,0,1,1,0,0,0,0,0,0,0,0,0,11,13,10,15,13,17,9,8,4,1,92,0,0,0,1,1,1,0,0,0,0,1,0,0,0,0,0,0,0,0,3,9,4,7,4,8,6,4,6,5,4,3,5,1,7,8,3,3,3,3,3,64,4,2,1,2,2,2,1,2,1,1,1,2,1,2,2,2,2,2,1,1,94,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,100,62,7,5,2,5,5,9,1,2,3,0,0,0,47,42,1,1,0,0,1,1,0,1,1,0,1,0,0,0,0,1,0,0,0,3,1,5,45,14,8,11,6,0,4,2,0,0,0,0,0,0,0,3,1,5,45,14,10,11,6,0,4,0,0,1,28,1,5,45,10,11,0,68,5,3,4,11,1,2,1,1,3,0,0,88,6,2,1,3,14,43,15,7,14,6,2,14,43,15,7,14,6,2,1,86,8,1,1,3,0,0,1,86,9,1,3,0,56,25,10,7,1,56,25,10,7,1,28,19,29,4,16,1,0,1,1,0,28,20,29,4,17,0,1,77,22,0,29,10,48,11,1,0,0,29,58,11,1,0,0,80,20]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>variable<\/th>\n      <th>value<\/th>\n      <th>freq<\/th>\n      <th>perc<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>factor_cols[set <span class="sc">==</span> <span class="st">"train"</span>, .N, by <span class="ot">=</span> .(funder,status_group)] <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    .[, perc <span class="sc">:</span><span class="er">=</span> <span class="fu">round</span>(N<span class="sc">/</span><span class="fu">sum</span>(N) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>), by <span class="ot">=</span> .(funder)] <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">ggplot</span>(<span class="fu">aes</span>(funder, perc, <span class="at">fill =</span> status_group)) <span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>     <span class="co"># geom_text(aes(funder, perc, label = paste0(perc, "%"),</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>     <span class="co">#               vjust = .05, hjust = .5),</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>     <span class="co">#           size = 3, position = position_stack(vjust = 0.5))+</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>     <span class="fu">theme_hc</span>()<span class="sc">+</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Percentage loans_"</span>)<span class="sc">+</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>     <span class="fu">scale_fill_economist</span>(<span class="at">name =</span> <span class="st">""</span>)<span class="sc">+</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="water_pumps_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>factor_cols[set <span class="sc">==</span> <span class="st">"train"</span>, .N, by <span class="ot">=</span> .(water_quality,status_group)] <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    .[, perc <span class="sc">:</span><span class="er">=</span> <span class="fu">round</span>(N<span class="sc">/</span><span class="fu">sum</span>(N) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>), by <span class="ot">=</span> .(water_quality)] <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">ggplot</span>(<span class="fu">aes</span>(water_quality, perc, <span class="at">fill =</span> status_group)) <span class="sc">+</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_text</span>(<span class="fu">aes</span>(water_quality, perc, <span class="at">label =</span> <span class="fu">paste</span>(perc, <span class="st">"%"</span>),</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">vjust =</span> .<span class="dv">05</span>, <span class="at">hjust =</span> .<span class="dv">5</span>),</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">3</span>, <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>))<span class="sc">+</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>     <span class="fu">theme_hc</span>()<span class="sc">+</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">""</span>)<span class="sc">+</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>     <span class="fu">scale_fill_economist</span>(<span class="at">name =</span> <span class="st">""</span>)<span class="sc">+</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="water_pumps_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>factor_cols[set <span class="sc">==</span> <span class="st">"train"</span>, .N, by <span class="ot">=</span> .(installer,status_group)] <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    .[, perc <span class="sc">:</span><span class="er">=</span> <span class="fu">round</span>(N<span class="sc">/</span><span class="fu">sum</span>(N) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>), by <span class="ot">=</span> .(installer)] <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">ggplot</span>(<span class="fu">aes</span>(installer, perc, <span class="at">fill =</span> status_group)) <span class="sc">+</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">theme_hc</span>()<span class="sc">+</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">""</span>)<span class="sc">+</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>     <span class="fu">scale_fill_economist</span>(<span class="at">name =</span> <span class="st">""</span>)<span class="sc">+</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="water_pumps_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>pump_data[construction_year <span class="sc">==</span> <span class="dv">0</span>, construction_year <span class="sc">:</span><span class="er">=</span> <span class="cn">NA</span>]</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pump_data<span class="sc">$</span>construction_year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
   1960    1988    2000    1997    2008    2013   25969 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>pump_data[, construction_year2  <span class="sc">:</span><span class="er">=</span> <span class="fu">cut</span>(construction_year, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1959</span>, <span class="dv">1988</span>, <span class="dv">2000</span>, <span class="dv">2008</span>, <span class="dv">2013</span>))]</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>pump_data[, construction_year2 <span class="sc">:</span><span class="er">=</span> <span class="fu">fct_explicit_na</span>(construction_year2, <span class="at">na_level =</span> <span class="st">"unknown"</span>)]</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pump_data<span class="sc">$</span>construction_year2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(1959,1988] (1988,2000] (2000,2008] (2008,2013]     unknown 
      12650       12585       13389        9657       25969 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># train_set &lt;- pump_data[set == "train",</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co">#                        .(status_group, go_funded, water_quality,</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co">#                          quantity,  construction_year2,</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co">#                          management_group, go_installer,</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co">#                          waterpoint_type_group1, longitude, latitude, basin,</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co">#                          management_group1)]</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co">#is there biase in recording</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>del_cols <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="st">"recorded_by"</span>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>data_clean <span class="ot">&lt;-</span> <span class="fu">cbind</span>(pump_data[, .(construction_year2, latitude, longitude)], factor_cols)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>train_set <span class="ot">&lt;-</span> data_clean[set <span class="sc">==</span> <span class="st">"train"</span>]</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>train_set[, set <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>char_cols2 <span class="ot">&lt;-</span> char_cols[<span class="sc">!</span>char_cols <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"status_group"</span> )]</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>train_set_dmmy <span class="ot">&lt;-</span> dummies<span class="sc">::</span><span class="fu">dummy.data.frame</span>(train_set, <span class="at">names =</span> char_cols2) <span class="sc">%&gt;%</span> <span class="fu">setDT</span>()</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>train_set_dmmy[, status_group <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(status_group,</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"functional"</span>, <span class="st">"functional needs repair"</span>, <span class="st">"non functional"</span>),</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">labels  =</span> <span class="fu">c</span>(<span class="st">"functional"</span>, <span class="st">"functional_needs_repair"</span>, <span class="st">"non_functional"</span>))]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co">#train_set &lt;- train_set[status_group %in% c("functional", "functional_needs_repair") ]</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>train_ind <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(train_set_dmmy), <span class="fu">round</span>(<span class="fl">0.7</span> <span class="sc">*</span> <span class="fu">nrow</span>(train_set)))</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>train_set_dmmy[, status_group <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(status_group)]</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>train_set1 <span class="ot">&lt;-</span> train_set_dmmy[train_ind,]</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>cv_fold <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(train_set1<span class="sc">$</span>status_group, <span class="at">k =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caretEnsemble)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>train_ctrl <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">number =</span> <span class="dv">3</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">summaryFunction =</span> multiClassSummary,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">classProbs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">allowParallel=</span>T,</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>                        <span class="at">index =</span> cv_fold,</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">verboseIter =</span> <span class="cn">TRUE</span>,</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>                        <span class="at">returnResamp =</span> <span class="st">"all"</span>, </span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>                        <span class="at">savePredictions =</span> <span class="st">"final"</span>, </span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>                        <span class="at">search =</span> <span class="st">"grid"</span>)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>xgb_grid <span class="ot">&lt;-</span>  <span class="fu">expand.grid</span>(<span class="at">nrounds =</span> <span class="fu">c</span>(<span class="dv">50</span>,<span class="dv">100</span>),</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>                        <span class="at">eta =</span> <span class="fl">0.06</span>,</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>                        <span class="at">max_depth =</span><span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">50</span>),</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>                        <span class="at">gamma =</span> <span class="dv">6</span>,</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>                        <span class="at">colsample_bytree =</span> <span class="fl">0.8</span>,</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>                        <span class="at">min_child_weight =</span><span class="fl">0.8</span>,</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>                        <span class="at">subsample =</span>  .<span class="dv">8</span>)</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>ranger_grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">splitrule =</span> <span class="st">"extratrees"</span>,</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>                        <span class="at">mtry =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">50</span>, <span class="dv">100</span>),</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>                        <span class="at">min.node.size =</span> <span class="dv">1</span>)</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>glmnet_grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">alpha =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>                           <span class="at">lambda =</span> <span class="fu">seq</span>(<span class="fl">0.0001</span>, <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tictoc)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tic</span>()</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>model_list <span class="ot">&lt;-</span> <span class="fu">caretList</span>(</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>   status_group<span class="sc">~</span>.,</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">data=</span>train_set1,</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">trControl=</span>train_ctrl,</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">tuneList =</span> <span class="fu">list</span>(<span class="fu">caretModelSpec</span>(<span class="at">method=</span><span class="st">"xgbTree"</span>, <span class="at">tuneGrid=</span> xgb_grid),</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">caretModelSpec</span>(<span class="at">method=</span><span class="st">"ranger"</span>, <span class="at">tuneGrid=</span> ranger_grid),</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">caretModelSpec</span>(<span class="at">method=</span><span class="st">"glmnet"</span>, <span class="at">tuneGrid=</span> glmnet_grid)</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>                    )</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+ Fold1: eta=0.06, max_depth=10, gamma=6, colsample_bytree=0.8, min_child_weight=0.8, subsample=0.8, nrounds=100 
[17:17:41] WARNING: src/c_api/c_api.cc:935: `ntree_limit` is deprecated, use `iteration_range` instead.
[17:17:42] WARNING: src/c_api/c_api.cc:935: `ntree_limit` is deprecated, use `iteration_range` instead.
- Fold1: eta=0.06, max_depth=10, gamma=6, colsample_bytree=0.8, min_child_weight=0.8, subsample=0.8, nrounds=100 
+ Fold1: eta=0.06, max_depth=50, gamma=6, colsample_bytree=0.8, min_child_weight=0.8, subsample=0.8, nrounds=100 
[17:18:21] WARNING: src/c_api/c_api.cc:935: `ntree_limit` is deprecated, use `iteration_range` instead.
[17:18:21] WARNING: src/c_api/c_api.cc:935: `ntree_limit` is deprecated, use `iteration_range` instead.
- Fold1: eta=0.06, max_depth=50, gamma=6, colsample_bytree=0.8, min_child_weight=0.8, subsample=0.8, nrounds=100 
+ Fold2: eta=0.06, max_depth=10, gamma=6, colsample_bytree=0.8, min_child_weight=0.8, subsample=0.8, nrounds=100 
[17:18:34] WARNING: src/c_api/c_api.cc:935: `ntree_limit` is deprecated, use `iteration_range` instead.
[17:18:34] WARNING: src/c_api/c_api.cc:935: `ntree_limit` is deprecated, use `iteration_range` instead.
- Fold2: eta=0.06, max_depth=10, gamma=6, colsample_bytree=0.8, min_child_weight=0.8, subsample=0.8, nrounds=100 
+ Fold2: eta=0.06, max_depth=50, gamma=6, colsample_bytree=0.8, min_child_weight=0.8, subsample=0.8, nrounds=100 
[17:19:14] WARNING: src/c_api/c_api.cc:935: `ntree_limit` is deprecated, use `iteration_range` instead.
[17:19:15] WARNING: src/c_api/c_api.cc:935: `ntree_limit` is deprecated, use `iteration_range` instead.
- Fold2: eta=0.06, max_depth=50, gamma=6, colsample_bytree=0.8, min_child_weight=0.8, subsample=0.8, nrounds=100 
+ Fold3: eta=0.06, max_depth=10, gamma=6, colsample_bytree=0.8, min_child_weight=0.8, subsample=0.8, nrounds=100 
[17:19:28] WARNING: src/c_api/c_api.cc:935: `ntree_limit` is deprecated, use `iteration_range` instead.
[17:19:28] WARNING: src/c_api/c_api.cc:935: `ntree_limit` is deprecated, use `iteration_range` instead.
- Fold3: eta=0.06, max_depth=10, gamma=6, colsample_bytree=0.8, min_child_weight=0.8, subsample=0.8, nrounds=100 
+ Fold3: eta=0.06, max_depth=50, gamma=6, colsample_bytree=0.8, min_child_weight=0.8, subsample=0.8, nrounds=100 
[17:20:10] WARNING: src/c_api/c_api.cc:935: `ntree_limit` is deprecated, use `iteration_range` instead.
[17:20:10] WARNING: src/c_api/c_api.cc:935: `ntree_limit` is deprecated, use `iteration_range` instead.
- Fold3: eta=0.06, max_depth=50, gamma=6, colsample_bytree=0.8, min_child_weight=0.8, subsample=0.8, nrounds=100 
Aggregating results
Selecting tuning parameters
Fitting nrounds = 100, max_depth = 50, eta = 0.06, gamma = 6, colsample_bytree = 0.8, min_child_weight = 0.8, subsample = 0.8 on full training set
+ Fold1: splitrule=extratrees, mtry= 20, min.node.size=1 
- Fold1: splitrule=extratrees, mtry= 20, min.node.size=1 
+ Fold1: splitrule=extratrees, mtry= 50, min.node.size=1 
- Fold1: splitrule=extratrees, mtry= 50, min.node.size=1 
+ Fold1: splitrule=extratrees, mtry=100, min.node.size=1 
Growing trees.. Progress: 85%. Estimated remaining time: 5 seconds.
- Fold1: splitrule=extratrees, mtry=100, min.node.size=1 
+ Fold2: splitrule=extratrees, mtry= 20, min.node.size=1 
- Fold2: splitrule=extratrees, mtry= 20, min.node.size=1 
+ Fold2: splitrule=extratrees, mtry= 50, min.node.size=1 
- Fold2: splitrule=extratrees, mtry= 50, min.node.size=1 
+ Fold2: splitrule=extratrees, mtry=100, min.node.size=1 
Growing trees.. Progress: 86%. Estimated remaining time: 5 seconds.
- Fold2: splitrule=extratrees, mtry=100, min.node.size=1 
+ Fold3: splitrule=extratrees, mtry= 20, min.node.size=1 
- Fold3: splitrule=extratrees, mtry= 20, min.node.size=1 
+ Fold3: splitrule=extratrees, mtry= 50, min.node.size=1 
- Fold3: splitrule=extratrees, mtry= 50, min.node.size=1 
+ Fold3: splitrule=extratrees, mtry=100, min.node.size=1 
Growing trees.. Progress: 87%. Estimated remaining time: 4 seconds.
- Fold3: splitrule=extratrees, mtry=100, min.node.size=1 
Aggregating results
Selecting tuning parameters
Fitting mtry = 20, splitrule = extratrees, min.node.size = 1 on full training set
+ Fold1: alpha=0, lambda=1 
- Fold1: alpha=0, lambda=1 
+ Fold1: alpha=1, lambda=1 
- Fold1: alpha=1, lambda=1 
+ Fold2: alpha=0, lambda=1 
- Fold2: alpha=0, lambda=1 
+ Fold2: alpha=1, lambda=1 
- Fold2: alpha=1, lambda=1 
+ Fold3: alpha=0, lambda=1 
- Fold3: alpha=0, lambda=1 
+ Fold3: alpha=1, lambda=1 
- Fold3: alpha=1, lambda=1 
Aggregating results
Selecting tuning parameters
Fitting alpha = 0, lambda = 1e-04 on full training set</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">toc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>703.553 sec elapsed</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>model_list</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$xgbTree
eXtreme Gradient Boosting 

41580 samples
  317 predictor
    3 classes: 'functional', 'functional_needs_repair', 'non_functional' 

No pre-processing
Resampling: Cross-Validated (3 fold) 
Summary of sample sizes: 13860, 13860, 13860 
Resampling results across tuning parameters:

  max_depth  nrounds  logLoss    AUC        prAUC      Accuracy   Kappa    
  10          50      0.6187243  0.8459881  0.6802115  0.7547860  0.5157636
  10         100      0.5926387  0.8524641  0.6887911  0.7603415  0.5298999
  50          50      0.6069728  0.8524588  0.6887281  0.7629149  0.5350648
  50         100      0.5779731  0.8594204  0.6984094  0.7674723  0.5473892
  Mean_F1    Mean_Sensitivity  Mean_Specificity  Mean_Pos_Pred_Value
  0.5711633  0.5540417         0.8301047         0.7595898          
  0.5830710  0.5640156         0.8356069         0.7594603          
  0.5860981  0.5666008         0.8372974         0.7603948          
  0.5977618  0.5766923         0.8423961         0.7548314          
  Mean_Neg_Pred_Value  Mean_Precision  Mean_Recall  Mean_Detection_Rate
  0.8722563            0.7595898       0.5540417    0.2515953          
  0.8716314            0.7594603       0.5640156    0.2534472          
  0.8736187            0.7603948       0.5666008    0.2543050          
  0.8726430            0.7548314       0.5766923    0.2558241          
  Mean_Balanced_Accuracy
  0.6920732             
  0.6998113             
  0.7019491             
  0.7095442             

Tuning parameter 'eta' was held constant at a value of 0.06
Tuning

Tuning parameter 'min_child_weight' was held constant at a value of 0.8

Tuning parameter 'subsample' was held constant at a value of 0.8
Accuracy was used to select the optimal model using the largest value.
The final values used for the model were nrounds = 100, max_depth = 50, eta
 = 0.06, gamma = 6, colsample_bytree = 0.8, min_child_weight = 0.8
 and subsample = 0.8.

$ranger
Random Forest 

41580 samples
  317 predictor
    3 classes: 'functional', 'functional_needs_repair', 'non_functional' 

No pre-processing
Resampling: Cross-Validated (3 fold) 
Summary of sample sizes: 13860, 13860, 13860 
Resampling results across tuning parameters:

  mtry  logLoss    AUC        prAUC      Accuracy   Kappa      Mean_F1  
   20   0.5492160  0.8714603  0.7145098  0.7794733  0.5791659  0.6402572
   50   0.6023253  0.8673458  0.6758671  0.7755652  0.5770019  0.6462120
  100   0.7126941  0.8630358  0.6359068  0.7730159  0.5748031  0.6475980
  Mean_Sensitivity  Mean_Specificity  Mean_Pos_Pred_Value  Mean_Neg_Pred_Value
  0.6144159         0.8551479         0.7242051            0.8751245          
  0.6242823         0.8562681         0.6974150            0.8701457          
  0.6282465         0.8564829         0.6870313            0.8676719          
  Mean_Precision  Mean_Recall  Mean_Detection_Rate  Mean_Balanced_Accuracy
  0.7242051       0.6144159    0.2598244            0.7347819             
  0.6974150       0.6242823    0.2585217            0.7402752             
  0.6870313       0.6282465    0.2576720            0.7423647             

Tuning parameter 'splitrule' was held constant at a value of extratrees

Tuning parameter 'min.node.size' was held constant at a value of 1
Accuracy was used to select the optimal model using the largest value.
The final values used for the model were mtry = 20, splitrule = extratrees
 and min.node.size = 1.

$glmnet
glmnet 

41580 samples
  317 predictor
    3 classes: 'functional', 'functional_needs_repair', 'non_functional' 

No pre-processing
Resampling: Cross-Validated (3 fold) 
Summary of sample sizes: 13860, 13860, 13860 
Resampling results across tuning parameters:

  alpha  lambda   logLoss    AUC        prAUC      Accuracy   Kappa    
  0      0.00010  0.6218298  0.8319479  0.6497870  0.7439514  0.5036845
  0      0.50005  0.6746615  0.8169808  0.6330926  0.7311568  0.4643535
  0      1.00000  0.7068795  0.8096260  0.6250271  0.7228114  0.4433703
  1      0.00010  0.6251197  0.8319851  0.6495486  0.7437350  0.5066840
  1      0.50005  0.8893577  0.5000000  0.0000000  0.5424242  0.0000000
  1      1.00000  0.8893577  0.5000000  0.0000000  0.5424242  0.0000000
  Mean_F1    Mean_Sensitivity  Mean_Specificity  Mean_Pos_Pred_Value
  0.5646638  0.5517857         0.8294169         0.6773631          
        NaN  0.5068225         0.8139668               NaN          
        NaN  0.4978057         0.8061242               NaN          
  0.5783964  0.5619689         0.8310915         0.6650360          
        NaN  0.3333333         0.6666667               NaN          
        NaN  0.3333333         0.6666667               NaN          
  Mean_Neg_Pred_Value  Mean_Precision  Mean_Recall  Mean_Detection_Rate
  0.8538487            0.6773631       0.5517857    0.2479838          
  0.8556091                  NaN       0.5068225    0.2437189          
  0.8557185                  NaN       0.4978057    0.2409371          
  0.8526489            0.6650360       0.5619689    0.2479117          
        NaN                  NaN       0.3333333    0.1808081          
        NaN                  NaN       0.3333333    0.1808081          
  Mean_Balanced_Accuracy
  0.6906013             
  0.6603946             
  0.6519649             
  0.6965302             
  0.5000000             
  0.5000000             

Accuracy was used to select the optimal model using the largest value.
The final values used for the model were alpha = 0 and lambda = 1e-04.

attr(,"class")
[1] "caretList"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>test_own <span class="ot">&lt;-</span> train_set_dmmy[<span class="sc">-</span>train_ind]</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>accuracy <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(model_list)) {</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    rf <span class="ot">&lt;-</span> model_list[[i]]</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf,  <span class="at">newdata =</span> test_own)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>   <span class="co">#auc[i] &lt;-  caret::(pred, test_own$status_group)</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>   accuracy[i] <span class="ot">&lt;-</span>  <span class="fu">round</span>(Metrics<span class="sc">::</span><span class="fu">accuracy</span>(pred, test_own<span class="sc">$</span>status_group) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>pred_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">models =</span> <span class="fu">names</span>(model_list), accuracy)</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(pred_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-79b4bb4c52ceee36434f" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-79b4bb4c52ceee36434f">{"x":{"filter":"none","vertical":false,"data":[["1","2","3"],["xgbTree","ranger","glmnet"],[79,79.49,74.4]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>models<\/th>\n      <th>accuracy<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":2},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>resamples_models <span class="ot">&lt;-</span> <span class="fu">resamples</span>(model_list)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dotplot</span>(resamples_models, <span class="at">metric =</span> <span class="st">"AUC"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="water_pumps_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternatively, you can put in dense matrix, i.e. basic R-matrix</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># library(lightgbm)</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co"># train_x &lt;- as.matrix(train_set1[, !status_group])</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># train_y &lt;- train_set1$status_group</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co"># params = list('task'= 'train',</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co">#     'boosting_type'= 'gbdt',</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co">#     'objective'= 'multiclass',</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co">#     'num_class'=3,</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="co">#     'metric'= 'multi_logloss',</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="co">#     'learning_rate'= 0.002296,</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="co">#     'max_depth'= 7,</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="co">#     'num_leaves'= 17,</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="co">#     'feature_fraction'= 0.4,</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="co">#     'bagging_fraction'= 0.6,</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a><span class="co">#     'bagging_freq'= 17)</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="co"># train_lgb = lgb.Dataset(data = train_x , label = train_y, params = params)</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a><span class="co"># print("Training lightgbm with Matrix")</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a><span class="co"># bst &lt;- lightgbm(</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a><span class="co">#     data = train_lgb</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a><span class="co">#     , num_leaves = 4L</span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a><span class="co">#     , learning_rate = 1.0</span></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a><span class="co">#     , nrounds = 2L</span></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a><span class="co">#     , objective = "multiclass"</span></span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>
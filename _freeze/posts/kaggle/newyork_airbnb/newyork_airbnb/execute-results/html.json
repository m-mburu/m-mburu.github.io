{
  "hash": "16d56b91fbdb69bb56116c7e927e063c",
  "result": {
    "markdown": "---\ntitle: \"New york Airbnb\"\nauthor: \"Mburu\"\ndate: \"7/17/2020\"\noutput:\n  html_document:\n    toc: true\n    toc_depth: 2\n    toc_float:\n      collapsed: false\n      smooth_scroll: false\n    theme: united\n    highlight: pygments\n---\n\n\n\n\n## Packages used\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(data.table)\nlibrary(DT)\nlibrary(ggthemes)\nlibrary(leaflet)\nlibrary(ggmap)\nlibrary(plotly)\nlibrary(lubridate)\n```\n:::\n\n\n## First few variables\n\n\n::: {.cell}\n\n```{.r .cell-code}\nairbnb_nyc <- fread(\"AB_NYC_2019.csv\")\n\nhead(airbnb_nyc) %>% \n    datatable(options = list(scrollX = TRUE))\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"datatables html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-d68738c655c2e61e1a47\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-d68738c655c2e61e1a47\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"1\",\"2\",\"3\",\"4\",\"5\",\"6\"],[2539,2595,3647,3831,5022,5099],[\"Clean &amp; quiet apt home by the park\",\"Skylit Midtown Castle\",\"THE VILLAGE OF HARLEM....NEW YORK !\",\"Cozy Entire Floor of Brownstone\",\"Entire Apt: Spacious Studio/Loft by central park\",\"Large Cozy 1 BR Apartment In Midtown East\"],[2787,2845,4632,4869,7192,7322],[\"John\",\"Jennifer\",\"Elisabeth\",\"LisaRoxanne\",\"Laura\",\"Chris\"],[\"Brooklyn\",\"Manhattan\",\"Manhattan\",\"Brooklyn\",\"Manhattan\",\"Manhattan\"],[\"Kensington\",\"Midtown\",\"Harlem\",\"Clinton Hill\",\"East Harlem\",\"Murray Hill\"],[40.64749,40.75362,40.80902,40.68514,40.79851,40.74767],[-73.97237,-73.98377,-73.9419,-73.95976,-73.94399,-73.975],[\"Private room\",\"Entire home/apt\",\"Private room\",\"Entire home/apt\",\"Entire home/apt\",\"Entire home/apt\"],[149,225,150,89,80,200],[1,1,3,1,10,3],[9,45,0,270,9,74],[\"2018-10-19\",\"2019-05-21\",null,\"2019-07-05\",\"2018-11-19\",\"2019-06-22\"],[0.21,0.38,null,4.64,0.1,0.59],[6,2,1,1,1,1],[365,355,365,194,0,129]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>id<\\/th>\\n      <th>name<\\/th>\\n      <th>host_id<\\/th>\\n      <th>host_name<\\/th>\\n      <th>neighbourhood_group<\\/th>\\n      <th>neighbourhood<\\/th>\\n      <th>latitude<\\/th>\\n      <th>longitude<\\/th>\\n      <th>room_type<\\/th>\\n      <th>price<\\/th>\\n      <th>minimum_nights<\\/th>\\n      <th>number_of_reviews<\\/th>\\n      <th>last_review<\\/th>\\n      <th>reviews_per_month<\\/th>\\n      <th>calculated_host_listings_count<\\/th>\\n      <th>availability_365<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"scrollX\":true,\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[1,3,7,8,10,11,12,14,15,16]},{\"orderable\":false,\"targets\":0}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n## Neighbourhood Disitribution\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1 <- airbnb_nyc[, .(freq = .N), by =  neighbourhood_group] %>%\n    .[, perc := round(freq/sum(freq) *100, 2)] %>%\n    ggplot(aes(neighbourhood_group, perc))+\n    geom_bar(stat = \"identity\", width = 0.5, fill =\"slategray2\"  ) +\n    geom_text(aes(neighbourhood_group, perc, label = paste0(perc, \"%\")),\n              position = position_dodge(width = 0.5),\n              vjust = 0.07)+\n    theme_fivethirtyeight() \np1\n```\n\n::: {.cell-output-display}\n![](newyork_airbnb_files/figure-html/unnamed-chunk-2-1.png){width=768}\n:::\n:::\n\n\n## Popular room types in neighbourhoods Disitribution\n\n\n::: {.cell}\n\n```{.r .cell-code}\nairbnb_nyc[, .(freq =.N), by = .(neighbourhood_group, room_type)] %>%\n  .[, perc := round(freq/sum(freq) *100, 2), by = neighbourhood_group] %>%\n  ggplot(aes(neighbourhood_group, perc, fill = room_type))+\n  geom_bar(stat = \"identity\", width = 0.5 ) +\n    geom_text(aes(neighbourhood_group, perc, label = paste0(perc, \"%\")),\n              position = position_stack(vjust = 0.5),\n              vjust = 0.07)+\n  scale_fill_viridis_d(name = \"\")+\n    theme_fivethirtyeight() \n```\n\n::: {.cell-output-display}\n![](newyork_airbnb_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n## Summary Stats for price based on location\n\n\n::: {.cell}\n\n```{.r .cell-code}\nairbnb_nyc[, price := as.double(price)]\n\nsummary_function <- function(by_col){\n    \n    summary_stats <- airbnb_nyc[!is.na(price)&price !=0, \n                            .(Mean = round(mean(price), 2), \n                              Median = median(price),\n                              First_quartile = quantile(price, .25),\n                              Third_quartile = quantile(price, .75),\n                              Min = min(price),\n                              Max = max(price)),\n                            by = by_col]\n    return(summary_stats)\n}\n\n\ndatatable(summary_function(by_col = \"neighbourhood_group\"))\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"datatables html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-9b76dfe7293b1124692c\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-9b76dfe7293b1124692c\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"1\",\"2\",\"3\",\"4\",\"5\"],[\"Brooklyn\",\"Manhattan\",\"Queens\",\"Staten Island\",\"Bronx\"],[124.44,196.88,99.52,114.81,87.58],[90,150,75,75,65],[60,95,50,50,45],[150,220,110,110,99],[10,10,10,13,10],[10000,10000,10000,5000,2500]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>neighbourhood_group<\\/th>\\n      <th>Mean<\\/th>\\n      <th>Median<\\/th>\\n      <th>First_quartile<\\/th>\\n      <th>Third_quartile<\\/th>\\n      <th>Min<\\/th>\\n      <th>Max<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[2,3,4,5,6,7]},{\"orderable\":false,\"targets\":0}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n## Summary Stats price based on room type\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndatatable(summary_function(by_col = \"room_type\"))\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"datatables html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-0f5f81149435d7ab388a\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-0f5f81149435d7ab388a\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"1\",\"2\",\"3\"],[\"Private room\",\"Entire home/apt\",\"Shared room\"],[89.81,211.81,70.25],[70,160,45],[50,120,33],[95,229,75],[10,10,10],[10000,10000,1800]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>room_type<\\/th>\\n      <th>Mean<\\/th>\\n      <th>Median<\\/th>\\n      <th>First_quartile<\\/th>\\n      <th>Third_quartile<\\/th>\\n      <th>Min<\\/th>\\n      <th>Max<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[2,3,4,5,6,7]},{\"orderable\":false,\"targets\":0}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n## Median price roomtype in different neighbourhoods\n\n\n::: {.cell}\n\n```{.r .cell-code}\nairbnb_nyc[, .(Median = median(price)), \n           by = .(neighbourhood_group, room_type)] %>%\n  dcast(neighbourhood_group ~room_type, value.var = \"Median\") %>%\n  datatable()\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"datatables html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-c76ad64e5451c929dbf7\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-c76ad64e5451c929dbf7\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"1\",\"2\",\"3\",\"4\",\"5\"],[\"Bronx\",\"Brooklyn\",\"Manhattan\",\"Queens\",\"Staten Island\"],[100,145,191,120,100],[53.5,65,90,60,50],[40,36,69,37,30]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>neighbourhood_group<\\/th>\\n      <th>Entire home/apt<\\/th>\\n      <th>Private room<\\/th>\\n      <th>Shared room<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[2,3,4]},{\"orderable\":false,\"targets\":0}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n## Get map using ggmap\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnewyork_map <- get_map(c(left = min(airbnb_nyc$longitude) - .0001,\n                         bottom = min(airbnb_nyc$latitude) - .0001,\n                         right = max(airbnb_nyc$longitude) + .0001,\n                         top = max(airbnb_nyc$latitude) + .0001),\n                       maptype = \"watercolor\", source = \"stamen\")\n```\n:::\n\n\n## Mapping function\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmap_plot <- function(df, color_col, continues_color_col = TRUE){\n  \n  if(continues_color_col) {\n    \n    scale_fill <- scale_color_viridis_c()\n    \n    } else{\n      \n      scale_fill <- scale_color_viridis_d()\n      \n    }\n    \n    \n  ggmap(newyork_map) +\n    geom_point(data =df, \n               aes_string(\"longitude\", \"latitude\",\n                          color = color_col), size = 1)+\n    theme(legend.position = \"bottom\")+\n                           \n    scale_fill\n  \n  \n}\n```\n:::\n\n\n## Newyork price map\n\n\n::: {.cell}\n\n```{.r .cell-code}\nper95 <- airbnb_nyc[, quantile(price, 0.95)]\nmap_plot(df = airbnb_nyc[price <=per95  ], \n         color_col = \"price\")  \n```\n\n::: {.cell-output-display}\n![](newyork_airbnb_files/figure-html/unnamed-chunk-9-1.png){width=768}\n:::\n:::\n\n\n## Categorise price variable\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbreaks <-  quantile(airbnb_nyc$price, seq(0, 1, by = .1))\n\nairbnb_nyc[, price_factor := cut(price, breaks = breaks,\n                                 include.lowest = TRUE)]\n\nmap_plot(df = airbnb_nyc, \n         color_col = \"price_factor\",\n         continues_color_col = FALSE)  \n```\n\n::: {.cell-output-display}\n![](newyork_airbnb_files/figure-html/unnamed-chunk-10-1.png){width=768}\n:::\n:::\n\n\n## Reviews per month\n\n-   We can use this as a proxy of host receiving a lot of guests\n-   we could use this for instance to check if some neighborhoods are more popular\n\n\n::: {.cell}\n\n```{.r .cell-code}\nper95_rev <- airbnb_nyc[!is.na(last_review) & !is.na(reviews_per_month),\n                        quantile(reviews_per_month, 0.95)]\n\nmap_plot(df = airbnb_nyc[reviews_per_month < per95_rev ], \n         color_col = \"reviews_per_month\")  \n```\n\n::: {.cell-output-display}\n![](newyork_airbnb_files/figure-html/unnamed-chunk-11-1.png){width=768}\n:::\n:::\n\n\n## Dates\n\n\n::: {.cell}\n\n```{.r .cell-code}\nairbnb_nyc[, last_review := ymd(last_review)]\nairbnb_nyc[, summary(last_review)]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        Min.      1st Qu.       Median         Mean      3rd Qu.         Max. \n\"2011-03-28\" \"2018-07-08\" \"2019-05-19\" \"2018-10-04\" \"2019-06-23\" \"2019-07-08\" \n        NA's \n     \"10052\" \n```\n:::\n:::\n\n\n-   Work in progress !\n",
    "supporting": [
      "newyork_airbnb_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../../site_libs/htmlwidgets-1.6.1/htmlwidgets.js\"></script>\n<link href=\"../../../site_libs/datatables-css-0.0.0/datatables-crosstalk.css\" rel=\"stylesheet\" />\n<script src=\"../../../site_libs/datatables-binding-0.27/datatables.js\"></script>\n<script src=\"../../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\n<link href=\"../../../site_libs/dt-core-1.12.1/css/jquery.dataTables.min.css\" rel=\"stylesheet\" />\n<link href=\"../../../site_libs/dt-core-1.12.1/css/jquery.dataTables.extra.css\" rel=\"stylesheet\" />\n<script src=\"../../../site_libs/dt-core-1.12.1/js/jquery.dataTables.min.js\"></script>\n<link href=\"../../../site_libs/crosstalk-1.2.0/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"../../../site_libs/crosstalk-1.2.0/js/crosstalk.min.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
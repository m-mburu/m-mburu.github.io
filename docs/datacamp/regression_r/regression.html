<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Mburu">
<meta name="dcterms.date" content="2021-04-13">

<title>Personal Blog - Multiple Linear and Logistic Regression in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../milkyway.jpeg" rel="icon" type="image/jpeg">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-BFNZ97VTLJ"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-BFNZ97VTLJ', { 'anonymize_ip': true});
</script>
<style>html{ scroll-behavior: smooth; }</style>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../style.css">
<meta property="og:title" content="Personal Blog - Multiple Linear and Logistic Regression in R">
<meta property="og:description" content="We use the lm() function to fit linear models to data.">
<meta property="og:site-name" content="Personal Blog">
<meta name="twitter:title" content="Personal Blog - Multiple Linear and Logistic Regression in R">
<meta name="twitter:description" content="We use the lm() function to fit linear models to data.">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Personal Blog</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../datacamp.html">
 <span class="menu-text">Data Camp Courses</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/m-mburu"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/mmburu_w"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-reader-toggle nav-link" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#fitting-a-parallel-slopes-model" id="toc-fitting-a-parallel-slopes-model" class="nav-link active" data-scroll-target="#fitting-a-parallel-slopes-model">Fitting a parallel slopes model</a></li>
  <li><a href="#reasoning-about-two-intercepts" id="toc-reasoning-about-two-intercepts" class="nav-link" data-scroll-target="#reasoning-about-two-intercepts">Reasoning about two intercepts</a></li>
  <li><a href="#using-geom_line-and-augment" id="toc-using-geom_line-and-augment" class="nav-link" data-scroll-target="#using-geom_line-and-augment">Using geom_line() and augment()</a></li>
  <li><a href="#intercept-interpretation" id="toc-intercept-interpretation" class="nav-link" data-scroll-target="#intercept-interpretation">Intercept interpretation</a></li>
  <li><a href="#syntax-from-plot" id="toc-syntax-from-plot" class="nav-link" data-scroll-target="#syntax-from-plot">Syntax from plot</a></li>
  <li><a href="#prediction" id="toc-prediction" class="nav-link" data-scroll-target="#prediction">Prediction</a></li>
  <li><a href="#thought-experiments" id="toc-thought-experiments" class="nav-link" data-scroll-target="#thought-experiments">Thought experiments</a></li>
  <li><a href="#fitting-a-model-with-interaction" id="toc-fitting-a-model-with-interaction" class="nav-link" data-scroll-target="#fitting-a-model-with-interaction">Fitting a model with interaction</a></li>
  <li><a href="#visualizing-interaction-models" id="toc-visualizing-interaction-models" class="nav-link" data-scroll-target="#visualizing-interaction-models">Visualizing interaction models</a></li>
  <li><a href="#consequences-of-simpsons-paradox" id="toc-consequences-of-simpsons-paradox" class="nav-link" data-scroll-target="#consequences-of-simpsons-paradox">Consequences of Simpson’s paradox</a></li>
  <li><a href="#simpsons-paradox-in-action" id="toc-simpsons-paradox-in-action" class="nav-link" data-scroll-target="#simpsons-paradox-in-action">Simpson’s paradox in action</a></li>
  <li><a href="#fitting-a-mlr-model" id="toc-fitting-a-mlr-model" class="nav-link" data-scroll-target="#fitting-a-mlr-model">Fitting a MLR model</a></li>
  <li><a href="#tiling-the-plane" id="toc-tiling-the-plane" class="nav-link" data-scroll-target="#tiling-the-plane">Tiling the plane</a></li>
  <li><a href="#models-in-3d" id="toc-models-in-3d" class="nav-link" data-scroll-target="#models-in-3d">Models in 3D</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Multiple Linear and Logistic Regression in R</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Mburu </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 13, 2021</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="fitting-a-parallel-slopes-model" class="level2">
<h2 class="anchored" data-anchor-id="fitting-a-parallel-slopes-model">Fitting a parallel slopes model</h2>
<p>We use the lm() function to fit linear models to data. In this case, we want to understand how the price of MarioKart games sold at auction varies as a function of not only the number of wheels included in the package, but also whether the item is new or used. Obviously, it is expected that you might have to pay a premium to buy these new. But how much is that premium? Can we estimate its value after controlling for the number of wheels?</p>
<p>We will fit a parallel slopes model using lm(). In addition to the data argument, lm() needs to know which variables you want to include in your regression model, and how you want to include them. It accomplishes this using a formula argument. A simple linear regression formula looks like y ~ x, where y is the name of the response variable, and x is the name of the explanatory variable. Here, we will simply extend this formula to include multiple explanatory variables. A parallel slopes model has the form y ~ x + z, where z is a categorical explanatory variable, and x is a numerical explanatory variable.</p>
<p>The output from lm() is a model object, which when printed, will show the fitted coefficients.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(openintro)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pander)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>( mariokart, <span class="at">package =</span> <span class="st">"openintro"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>mario_kart <span class="ot">&lt;-</span> mariokart</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>mario_kart <span class="ot">&lt;-</span> mario_kart <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">total_pr :=</span> <span class="fu">ifelse</span>(total_pr <span class="sc">&gt;</span> <span class="dv">100</span>, <span class="cn">NA</span>, total_pr))</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Explore the data</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(mario_kart)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 143
Columns: 12
$ id          &lt;dbl&gt; 150377422259, 260483376854, 320432342985, 280405224677, 17…
$ duration    &lt;int&gt; 3, 7, 3, 3, 1, 3, 1, 1, 3, 7, 1, 1, 1, 1, 7, 7, 3, 3, 1, 7…
$ n_bids      &lt;int&gt; 20, 13, 16, 18, 20, 19, 13, 15, 29, 8, 15, 15, 13, 16, 6, …
$ cond        &lt;fct&gt; new, used, new, new, new, new, used, new, used, used, new,…
$ start_pr    &lt;dbl&gt; 0.99, 0.99, 0.99, 0.99, 0.01, 0.99, 0.01, 1.00, 0.99, 19.9…
$ ship_pr     &lt;dbl&gt; 4.00, 3.99, 3.50, 0.00, 0.00, 4.00, 0.00, 2.99, 4.00, 4.00…
$ total_pr    &lt;dbl&gt; 51.55, 37.04, 45.50, 44.00, 71.00, 45.00, 37.02, 53.99, 47…
$ ship_sp     &lt;fct&gt; standard, firstClass, firstClass, standard, media, standar…
$ seller_rate &lt;int&gt; 1580, 365, 998, 7, 820, 270144, 7284, 4858, 27, 201, 4858,…
$ stock_photo &lt;fct&gt; yes, yes, no, yes, yes, yes, yes, yes, yes, no, yes, yes, …
$ wheels      &lt;int&gt; 1, 1, 1, 1, 2, 0, 0, 2, 1, 1, 2, 2, 2, 2, 1, 0, 1, 1, 2, 2…
$ title       &lt;fct&gt; "~~ Wii MARIO KART &amp;amp; WHEEL ~ NINTENDO Wii ~ BRAND NEW …</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit parallel slopes</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>mod_mario <span class="ot">&lt;-</span> <span class="fu">lm</span>(total_pr <span class="sc">~</span> wheels <span class="sc">+</span> cond, <span class="at">data =</span> mario_kart)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="reasoning-about-two-intercepts" class="level2">
<h2 class="anchored" data-anchor-id="reasoning-about-two-intercepts">Reasoning about two intercepts</h2>
<p>The mario_kart data contains several other variables. The totalPr, startPr, and shipPr variables are numeric, while the cond and stockPhoto variables are categorical.</p>
<p>Which formula will result in a parallel slopes model?</p>
<ul>
<li>totalPr ~ shipPr + stockPhoto</li>
</ul>
</section>
<section id="using-geom_line-and-augment" class="level2">
<h2 class="anchored" data-anchor-id="using-geom_line-and-augment">Using geom_line() and augment()</h2>
<p>Parallel slopes models are so-named because we can visualize these models in the data space as not one line, but two parallel lines. To do this, we’ll draw two things:</p>
<p>a scatterplot showing the data, with color separating the points into groups a line for each value of the categorical variable Our plotting strategy is to compute the fitted values, plot these, and connect the points to form a line. The augment() function from the broom package provides an easy way to add the fitted values to our data frame, and the geom_line() function can then use that data frame to plot the points and connect them.</p>
<p>Note that this approach has the added benefit of automatically coloring the lines appropriately to match the data.</p>
<p>You already know how to use ggplot() and geom_point() to make the scatterplot. The only twist is that now you’ll pass your augment()-ed model as the data argument in your ggplot() call. When you add your geom_line(), instead of letting the y aesthetic inherit its values from the ggplot() call, you can set it to the .fitted column of the augment()-ed model. This has the advantage of automatically coloring the lines for you.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Augment the model</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>augmented_mod <span class="ot">&lt;-</span> <span class="fu">augment</span>(mod_mario)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(augmented_mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 141
Columns: 10
$ .rownames  &lt;chr&gt; "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "1…
$ total_pr   &lt;dbl&gt; 51.55, 37.04, 45.50, 44.00, 71.00, 45.00, 37.02, 53.99, 47.…
$ wheels     &lt;int&gt; 1, 1, 1, 1, 2, 0, 0, 2, 1, 1, 2, 2, 2, 2, 1, 0, 1, 1, 2, 0,…
$ cond       &lt;fct&gt; new, used, new, new, new, new, used, new, used, used, new, …
$ .fitted    &lt;dbl&gt; 49.60260, 44.01777, 49.60260, 49.60260, 56.83544, 42.36976,…
$ .resid     &lt;dbl&gt; 1.9473995, -6.9777674, -4.1026005, -5.6026005, 14.1645592, …
$ .hat       &lt;dbl&gt; 0.02103158, 0.01250410, 0.02103158, 0.02103158, 0.01915635,…
$ .sigma     &lt;dbl&gt; 4.902339, 4.868399, 4.892414, 4.881308, 4.750591, 4.899816,…
$ .cooksd    &lt;dbl&gt; 1.161354e-03, 8.712334e-03, 5.154337e-03, 9.612441e-03, 5.5…
$ .std.resid &lt;dbl&gt; 0.40270893, -1.43671086, -0.84838977, -1.15857953, 2.926332…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># scatterplot, with color</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>data_space <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(augmented_mod, <span class="fu">aes</span>(<span class="at">x =</span> wheels, <span class="at">y =</span> total_pr , <span class="at">color =</span> cond )) <span class="sc">+</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># single call to geom_line()</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>data_space <span class="sc">+</span> </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> .fitted))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="regression_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="intercept-interpretation" class="level2">
<h2 class="anchored" data-anchor-id="intercept-interpretation">Intercept interpretation</h2>
<p>Recall that the cond variable is either new or used. Here are the fitted coefficients from your model:</p>
<p>Call: lm(formula = totalPr ~ wheels + cond, data = mario_kart)</p>
<p>Coefficients: (Intercept) wheels condused<br>
42.370 7.233 -5.585<br>
Choose the correct interpretation of the coefficient on condused:</p>
<ul>
<li><p>The expected price of a used MarioKart is $5.58 less than that of a new one with the same number of wheels.</p></li>
<li><p>For each additional wheel, the expected price of a MarioKart increases by $7.23 regardless of whether it is new or used.</p></li>
</ul>
<p>Syntax from math The babies data set contains observations about the birthweight and other characteristics of children born in the San Francisco Bay area from 1960–1967.</p>
<p>We would like to build a model for birthweight as a function of the mother’s age and whether this child was her first (parity == 0). Use the mathematical specification below to code the model in R.</p>
<p><span class="math display">\[birthweight = \beta_0 + \beta_1 * age  + \beta_2 * parity + \epsilon\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>( babies, <span class="at">package =</span> <span class="st">"openintro"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(bwt<span class="sc">~</span> age<span class="sc">+</span>parity, <span class="at">data =</span> babies)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(mod) <span class="sc">%&gt;%</span> <span class="fu">pander</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 19%">
<col style="width: 15%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">term</th>
<th style="text-align: center;">estimate</th>
<th style="text-align: center;">std.error</th>
<th style="text-align: center;">statistic</th>
<th style="text-align: center;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">(Intercept)</td>
<td style="text-align: center;">118.3</td>
<td style="text-align: center;">2.788</td>
<td style="text-align: center;">42.43</td>
<td style="text-align: center;">3.957e-243</td>
</tr>
<tr class="even">
<td style="text-align: center;">age</td>
<td style="text-align: center;">0.06315</td>
<td style="text-align: center;">0.09577</td>
<td style="text-align: center;">0.6594</td>
<td style="text-align: center;">0.5097</td>
</tr>
<tr class="odd">
<td style="text-align: center;">parity</td>
<td style="text-align: center;">-1.652</td>
<td style="text-align: center;">1.271</td>
<td style="text-align: center;">-1.3</td>
<td style="text-align: center;">0.1937</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="syntax-from-plot" class="level2">
<h2 class="anchored" data-anchor-id="syntax-from-plot">Syntax from plot</h2>
<p>This time, we’d like to build a model for birthweight as a function of the length of gestation and the mother’s smoking status. Use the plot to inform your model specification.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(babies, <span class="fu">aes</span>(gestation, bwt, <span class="at">color =</span> <span class="fu">factor</span>(smoke)))<span class="sc">+</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="regression_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(bwt<span class="sc">~</span> gestation <span class="sc">+</span> smoke, <span class="at">data =</span> babies)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(mod) <span class="sc">%&gt;%</span> <span class="fu">pander</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 19%">
<col style="width: 15%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">term</th>
<th style="text-align: center;">estimate</th>
<th style="text-align: center;">std.error</th>
<th style="text-align: center;">statistic</th>
<th style="text-align: center;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">(Intercept)</td>
<td style="text-align: center;">-0.9317</td>
<td style="text-align: center;">8.152</td>
<td style="text-align: center;">-0.1143</td>
<td style="text-align: center;">0.909</td>
</tr>
<tr class="even">
<td style="text-align: center;">gestation</td>
<td style="text-align: center;">0.4429</td>
<td style="text-align: center;">0.02902</td>
<td style="text-align: center;">15.26</td>
<td style="text-align: center;">3.156e-48</td>
</tr>
<tr class="odd">
<td style="text-align: center;">smoke</td>
<td style="text-align: center;">-8.088</td>
<td style="text-align: center;">0.9527</td>
<td style="text-align: center;">-8.49</td>
<td style="text-align: center;">5.963e-17</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>R-squared vs.&nbsp;adjusted R-squared Two common measures of how well a model fits to data are <span class="math display">\[R^2\]</span> (the coefficient of determination) and the adjusted <span class="math display">\[R^2\]</span> . The former measures the percentage of the variability in the response variable that is explained by the model. To compute this, we define</p>
<p><span class="math display">\[R^2 = 1 - \frac{sse}{sst} \]</span> where SSE and SST are the sum of the squared residuals, and the total sum of the squares, respectively. One issue with this measure is that the can only decrease as new variable are added to the model, while the SST depends only on the response variable and therefore is not affected by changes to the model. This means that you can increase <span class="math display">\[R^2\]</span> by adding any additional variable to your model—even random noise.</p>
<p>The adjusted <span class="math display">\[R^2\]</span> includes a term that penalizes a model for each additional explanatory variable (where is the number of explanatory variables). We can see both measures in the output of the summary() function on our model object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R^2 and adjusted R^2</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_mario)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = total_pr ~ wheels + cond, data = mario_kart)

Residuals:
     Min       1Q   Median       3Q      Max 
-11.0078  -3.0754  -0.8254   2.9822  14.1646 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  42.3698     1.0651  39.780  &lt; 2e-16 ***
wheels        7.2328     0.5419  13.347  &lt; 2e-16 ***
condused     -5.5848     0.9245  -6.041 1.35e-08 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 4.887 on 138 degrees of freedom
  (2 observations deleted due to missingness)
Multiple R-squared:  0.7165,    Adjusted R-squared:  0.7124 
F-statistic: 174.4 on 2 and 138 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add random noise</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>mario_kart_noisy <span class="ot">&lt;-</span> mario_kart <span class="sc">%&gt;%</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">noise =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="fu">nrow</span>(mario_kart)))</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># compute new model</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>mod2_mario2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(total_pr <span class="sc">~</span> wheels <span class="sc">+</span> cond<span class="sc">+</span>noise, <span class="at">data =</span> mario_kart_noisy)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># new R^2 and adjusted R^2</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod2_mario2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = total_pr ~ wheels + cond + noise, data = mario_kart_noisy)

Residuals:
    Min      1Q  Median      3Q     Max 
-10.292  -3.224  -1.055   2.619  13.369 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  42.4194     1.0583  40.083  &lt; 2e-16 ***
wheels        7.2140     0.5383  13.401  &lt; 2e-16 ***
condused     -5.6717     0.9197  -6.167 7.33e-09 ***
noise         0.6738     0.3964   1.700   0.0914 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 4.854 on 137 degrees of freedom
  (2 observations deleted due to missingness)
Multiple R-squared:  0.7224,    Adjusted R-squared:  0.7163 
F-statistic: 118.8 on 3 and 137 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="prediction" class="level2">
<h2 class="anchored" data-anchor-id="prediction">Prediction</h2>
<p>Once we have fit a regression model, we can use it to make predictions for unseen observations or retrieve the fitted values. Here, we explore two methods for doing the latter.</p>
<p>A traditional way to return the fitted values (i.e.&nbsp;the y ’s) is to run the predict() function on the model object. This will return a vector of the fitted values. Note that predict() will take an optional newdata argument that will allow you to make predictions for observations that are not in the original data.</p>
<p>A newer alternative is the augment() function from the broom package, which returns a data.frame with the response varible (), the relevant explanatory variables (the ’s), the fitted value ( ) and some information about the residuals (). augment() will also take a newdata argument that allows you to make predictions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># return a vector</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(mod_mario)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       1        2        3        4        5        6        7        8 
49.60260 44.01777 49.60260 49.60260 56.83544 42.36976 36.78493 56.83544 
       9       10       11       12       13       14       15       16 
44.01777 44.01777 56.83544 56.83544 56.83544 56.83544 44.01777 36.78493 
      17       18       19       21       22       23       24       25 
49.60260 49.60260 56.83544 36.78493 56.83544 56.83544 56.83544 44.01777 
      26       27       28       29       30       31       32       33 
56.83544 36.78493 36.78493 36.78493 49.60260 36.78493 36.78493 44.01777 
      34       35       36       37       38       39       40       41 
51.25061 44.01777 44.01777 36.78493 44.01777 56.83544 56.83544 49.60260 
      42       43       44       45       46       47       48       49 
44.01777 51.25061 56.83544 56.83544 44.01777 56.83544 36.78493 36.78493 
      50       51       52       53       54       55       56       57 
44.01777 56.83544 36.78493 44.01777 42.36976 36.78493 36.78493 44.01777 
      58       59       60       61       62       63       64       66 
44.01777 36.78493 36.78493 56.83544 36.78493 56.83544 36.78493 51.25061 
      67       68       69       70       71       72       73       74 
56.83544 44.01777 58.48345 51.25061 49.60260 44.01777 49.60260 56.83544 
      75       76       77       78       79       80       81       82 
56.83544 51.25061 44.01777 36.78493 36.78493 36.78493 44.01777 56.83544 
      83       84       85       86       87       88       89       90 
44.01777 65.71629 44.01777 56.83544 36.78493 49.60260 49.60260 36.78493 
      91       92       93       94       95       96       97       98 
44.01777 36.78493 51.25061 44.01777 36.78493 51.25061 42.36976 56.83544 
      99      100      101      102      103      104      105      106 
51.25061 44.01777 51.25061 56.83544 56.83544 56.83544 36.78493 49.60260 
     107      108      109      110      111      112      113      114 
51.25061 44.01777 56.83544 49.60260 36.78493 44.01777 51.25061 56.83544 
     115      116      117      118      119      120      121      122 
64.06828 44.01777 49.60260 44.01777 49.60260 51.25061 42.36976 44.01777 
     123      124      125      126      127      128      129      130 
56.83544 44.01777 49.60260 44.01777 51.25061 56.83544 56.83544 49.60260 
     131      132      133      134      135      136      137      138 
56.83544 36.78493 44.01777 44.01777 36.78493 56.83544 36.78493 44.01777 
     139      140      141      142      143 
36.78493 51.25061 49.60260 36.78493 56.83544 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># return a data frame</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(mod_mario)<span class="sc">%&gt;%</span> <span class="fu">head</span>() <span class="sc">%&gt;%</span> <span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 11%">
<col style="width: 10%">
<col style="width: 7%">
<col style="width: 5%">
<col style="width: 10%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 10%">
<col style="width: 11%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">.rownames</th>
<th style="text-align: right;">total_pr</th>
<th style="text-align: right;">wheels</th>
<th style="text-align: left;">cond</th>
<th style="text-align: right;">.fitted</th>
<th style="text-align: right;">.resid</th>
<th style="text-align: right;">.hat</th>
<th style="text-align: right;">.sigma</th>
<th style="text-align: right;">.cooksd</th>
<th style="text-align: right;">.std.resid</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">51.55</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">new</td>
<td style="text-align: right;">49.60260</td>
<td style="text-align: right;">1.947399</td>
<td style="text-align: right;">0.0210316</td>
<td style="text-align: right;">4.902340</td>
<td style="text-align: right;">0.0011614</td>
<td style="text-align: right;">0.4027089</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: right;">37.04</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">used</td>
<td style="text-align: right;">44.01777</td>
<td style="text-align: right;">-6.977767</td>
<td style="text-align: right;">0.0125041</td>
<td style="text-align: right;">4.868399</td>
<td style="text-align: right;">0.0087123</td>
<td style="text-align: right;">-1.4367109</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: right;">45.50</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">new</td>
<td style="text-align: right;">49.60260</td>
<td style="text-align: right;">-4.102601</td>
<td style="text-align: right;">0.0210316</td>
<td style="text-align: right;">4.892414</td>
<td style="text-align: right;">0.0051543</td>
<td style="text-align: right;">-0.8483898</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: right;">44.00</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">new</td>
<td style="text-align: right;">49.60260</td>
<td style="text-align: right;">-5.602601</td>
<td style="text-align: right;">0.0210316</td>
<td style="text-align: right;">4.881308</td>
<td style="text-align: right;">0.0096124</td>
<td style="text-align: right;">-1.1585795</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5</td>
<td style="text-align: right;">71.00</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">new</td>
<td style="text-align: right;">56.83544</td>
<td style="text-align: right;">14.164559</td>
<td style="text-align: right;">0.0191563</td>
<td style="text-align: right;">4.750591</td>
<td style="text-align: right;">0.0557493</td>
<td style="text-align: right;">2.9263328</td>
</tr>
<tr class="even">
<td style="text-align: left;">6</td>
<td style="text-align: right;">45.00</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">new</td>
<td style="text-align: right;">42.36976</td>
<td style="text-align: right;">2.630240</td>
<td style="text-align: right;">0.0474932</td>
<td style="text-align: right;">4.899816</td>
<td style="text-align: right;">0.0050537</td>
<td style="text-align: right;">0.5514192</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="thought-experiments" class="level2">
<h2 class="anchored" data-anchor-id="thought-experiments">Thought experiments</h2>
<p>Suppose that after going apple picking you have 12 apples left over. You decide to conduct an experiment to investigate how quickly they will rot under certain conditions. You place six apples in a cool spot in your basement, and leave the other six on the window sill in the kitchen. Every week, you estimate the percentage of the surface area of the apple that is rotten or moldy.</p>
<p>Consider the following models:</p>
<p><span class="math display">\[rot = \beta_0 + \beta_1 *t + \beta_2 * temp + \epsilon \]</span></p>
<p>and</p>
<p><span class="math display">\[rot = \beta_0 + \beta_1 *t + \beta_2 * temp + \beta_2 * temp *t +  \epsilon \]</span></p>
<ul>
<li>The rate at which apples rot will vary based on the temperature.</li>
</ul>
</section>
<section id="fitting-a-model-with-interaction" class="level2">
<h2 class="anchored" data-anchor-id="fitting-a-model-with-interaction">Fitting a model with interaction</h2>
<p>Including an interaction term in a model is easy—we just have to tell lm() that we want to include that new variable. An expression of the form</p>
<pre><code>lm(y ~ x + z + x:z, data = mydata)</code></pre>
<p>will do the trick. The use of the colon (:) here means that the interaction between and will be a third term in the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># include interaction</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(total_pr <span class="sc">~</span>cond <span class="sc">+</span> duration <span class="sc">+</span> cond<span class="sc">:</span>duration, <span class="at">data =</span> mario_kart)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(mod) <span class="sc">%&gt;%</span> <span class="fu">pander</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 27%">
<col style="width: 15%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">term</th>
<th style="text-align: center;">estimate</th>
<th style="text-align: center;">std.error</th>
<th style="text-align: center;">statistic</th>
<th style="text-align: center;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">(Intercept)</td>
<td style="text-align: center;">58.27</td>
<td style="text-align: center;">1.366</td>
<td style="text-align: center;">42.64</td>
<td style="text-align: center;">5.832e-81</td>
</tr>
<tr class="even">
<td style="text-align: center;">condused</td>
<td style="text-align: center;">-17.12</td>
<td style="text-align: center;">2.178</td>
<td style="text-align: center;">-7.86</td>
<td style="text-align: center;">1.014e-12</td>
</tr>
<tr class="odd">
<td style="text-align: center;">duration</td>
<td style="text-align: center;">-1.966</td>
<td style="text-align: center;">0.4488</td>
<td style="text-align: center;">-4.38</td>
<td style="text-align: center;">2.342e-05</td>
</tr>
<tr class="even">
<td style="text-align: center;">condused:duration</td>
<td style="text-align: center;">2.325</td>
<td style="text-align: center;">0.5484</td>
<td style="text-align: center;">4.239</td>
<td style="text-align: center;">4.102e-05</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="visualizing-interaction-models" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-interaction-models">Visualizing interaction models</h2>
<p>Interaction allows the slope of the regression line in each group to vary. In this case, this means that the relationship between the final price and the length of the auction is moderated by the condition of each item.</p>
<p>Interaction models are easy to visualize in the data space with ggplot2 because they have the same coefficients as if the models were fit independently to each group defined by the level of the categorical variable. In this case, new and used MarioKarts each get their own regression line. To see this, we can set an aesthetic (e.g.&nbsp;color) to the categorical variable, and then add a geom_smooth() layer to overlay the regression line for each color.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># interaction plot</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mario_kart, <span class="fu">aes</span>(duration, total_pr, <span class="at">color =</span> cond)) <span class="sc">+</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="regression_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="consequences-of-simpsons-paradox" class="level2">
<h2 class="anchored" data-anchor-id="consequences-of-simpsons-paradox">Consequences of Simpson’s paradox</h2>
<p>In the simple linear regression model for average SAT score, (total) as a function of average teacher salary (salary), the fitted coefficient was -5.02 points per thousand dollars. This suggests that for every additional thousand dollars of salary for teachers in a particular state, the expected SAT score for a student from that state is about 5 points lower.</p>
<p>In the model that includes the percentage of students taking the SAT, the coefficient on salary becomes 1.84 points per thousand dollars. Choose the correct interpretation of this slope coefficient.</p>
<ul>
<li>For every additional thousand dollars of salary for teachers in a particular state, the expected SAT score for a student from that state is about 2 points higher, after controlling for the percentage of students taking the SAT.</li>
</ul>
</section>
<section id="simpsons-paradox-in-action" class="level2">
<h2 class="anchored" data-anchor-id="simpsons-paradox-in-action">Simpson’s paradox in action</h2>
<p>A mild version of Simpson’s paradox can be observed in the MarioKart auction data. Consider the relationship between the final auction price and the length of the auction. It seems reasonable to assume that longer auctions would result in higher prices, since—other things being equal—a longer auction gives more bidders more time to see the auction and bid on the item.</p>
<p>However, a simple linear regression model reveals the opposite: longer auctions are associated with lower final prices. The problem is that all other things are not equal. In this case, the new MarioKarts—which people pay a premium for—were mostly sold in one-day auctions, while a plurality of the used MarioKarts were sold in the standard seven-day auctions.</p>
<p>Our simple linear regression model is misleading, in that it suggests a negative relationship between final auction price and duration. However, for the used MarioKarts, the relationship is positive.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>slr <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mario_kart, <span class="fu">aes</span>(<span class="at">y =</span> total_pr, <span class="at">x =</span> duration)) <span class="sc">+</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># model with one slope</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(total_pr <span class="sc">~</span> duration, <span class="at">data =</span> mario_kart)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co"># plot with two slopes</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>slr <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">color =</span> cond)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="regression_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="fitting-a-mlr-model" class="level2">
<h2 class="anchored" data-anchor-id="fitting-a-mlr-model">Fitting a MLR model</h2>
<p>In terms of the R code, fitting a multiple linear regression model is easy: simply add variables to the model formula you specify in the lm() command.</p>
<p>In a parallel slopes model, we had two explanatory variables: one was numeric and one was categorical. Here, we will allow both explanatory variables to be numeric.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model using duration and startPr</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(total_pr<span class="sc">~</span> start_pr <span class="sc">+</span> duration, <span class="at">data =</span> mario_kart)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(mod) <span class="sc">%&gt;%</span> <span class="fu">pander</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 19%">
<col style="width: 15%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">term</th>
<th style="text-align: center;">estimate</th>
<th style="text-align: center;">std.error</th>
<th style="text-align: center;">statistic</th>
<th style="text-align: center;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">(Intercept)</td>
<td style="text-align: center;">51.03</td>
<td style="text-align: center;">1.179</td>
<td style="text-align: center;">43.28</td>
<td style="text-align: center;">3.666e-82</td>
</tr>
<tr class="even">
<td style="text-align: center;">start_pr</td>
<td style="text-align: center;">0.233</td>
<td style="text-align: center;">0.04364</td>
<td style="text-align: center;">5.339</td>
<td style="text-align: center;">3.756e-07</td>
</tr>
<tr class="odd">
<td style="text-align: center;">duration</td>
<td style="text-align: center;">-1.508</td>
<td style="text-align: center;">0.2555</td>
<td style="text-align: center;">-5.902</td>
<td style="text-align: center;">2.645e-08</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="tiling-the-plane" class="level2">
<h2 class="anchored" data-anchor-id="tiling-the-plane">Tiling the plane</h2>
<p>One method for visualizing a multiple linear regression model is to create a heatmap of the fitted values in the plane defined by the two explanatory variables. This heatmap will illustrate how the model output changes over different combinations of the explanatory variables.</p>
<p>This is a multistep process:</p>
<p>First, create a grid of the possible pairs of values of the explanatory variables. The grid should be over the actual range of the data present in each variable. We’ve done this for you and stored the result as a data frame called grid. Use augment() with the newdata argument to find the ’s corresponding to the values in grid. Add these to the data_space plot by using the fill aesthetic and geom_tile().</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add predictions to grid</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>price_hats <span class="ot">&lt;-</span> <span class="fu">augment</span>(mod, <span class="at">newdata =</span> grid)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># tile the plane</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>data_space <span class="sc">+</span> </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">data =</span> price_hats, <span class="fu">aes</span>(<span class="at">fill =</span> .fitted), <span class="at">alpha =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="models-in-3d" class="level2">
<h2 class="anchored" data-anchor-id="models-in-3d">Models in 3D</h2>
<p>An alternative way to visualize a multiple regression model with two numeric explanatory variables is as a plane in three dimensions. This is possible in R using the plotly package.</p>
<p>We have created three objects that you will need:</p>
<p>x: a vector of unique values of duration y: a vector of unique values of startPr plane: a matrix of the fitted values across all combinations of x and y Much like ggplot(), the plot_ly() function will allow you to create a plot object with variables mapped to x, y, and z aesthetics. The add_markers() function is similar to geom_point() in that it allows you to add points to your 3D plot.</p>
<p>Note that plot_ly uses the pipe (%&gt;%) operator to chain commands together.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># draw the 3D scatterplot</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(<span class="at">data =</span> mario_kart, <span class="at">z =</span> <span class="sc">~</span>totalPr, <span class="at">x =</span> <span class="sc">~</span>duration, <span class="at">y =</span> <span class="sc">~</span>startPr, <span class="at">opacity =</span> <span class="fl">0.6</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_markers</span>() </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co"># draw the plane</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>p <span class="sc">%&gt;%</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_surface</span>(<span class="at">x =</span> <span class="sc">~</span>x, <span class="at">y =</span> <span class="sc">~</span>y, <span class="at">z =</span> <span class="sc">~</span>plane, <span class="at">showscale =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>